<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Panel del Administrador</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <h2>Bienvenido al panel de administración, <span th:text="${usuario.nombre}"></span></h2>

    <div th:if="${isAdminPrincipal}">
        <div class="dropdown">
            <button type="button" onclick="toggleDropdown()" class="btn-registrar">Registrar Admin</button>
            <div id="dropdownContent" class="dropdown-content">
                <form th:action="@{/admin/registrar-admin}" th:object="${nuevoAdmin}" method="post" id="formRegistroAdmin">
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" th:field="*{nombre}" placeholder="Ej: Juan Pérez" required><br>
                    <label for="email">Correo Electrónico:</label>
                    <input type="email" id="email" th:field="*{email}" placeholder="Ej: admin@ejemplo.com" required><br>
                    <label for="password">Contraseña:</label>
                    <input type="password" id="password" th:field="*{password}" placeholder="••••••••" required><br>
                    <button type="submit" class="btn-submit">Registrar Admin</button>
                    <button type="button" onclick="toggleDropdown()" class="btn-cancel">Cancelar</button>
                </form>
            </div>
        </div>
    </div>

    <h3>Lista de Reportes</h3>
    <table border="1">
        <tr>
            <th>Título</th>
            <th>Descripción</th>
            <th>Dirección</th>
            <th>Barrio</th>
            <th>Tipo</th>
            <th>Estado</th>
            <th>Fecha Creación</th>
            <th>Usuario</th>
            <th>Admin Asignado</th>
            <th>Acciones</th>
        </tr>
        <tr th:each="r : ${reportes}">
            <td th:text="${r.titulo}"></td>
            <td th:text="${r.descripcion}"></td>
            <td th:text="${r.direccion}"></td>
            <td th:text="${r.barrio.nombre}"></td>
            <td th:text="${r.tipo.nombre}"></td>
            <td th:text="${r.estado}"></td>
            <td th:text="${#temporals.format(r.fechaCreacion, 'dd/MM/yyyy HH:mm')}"></td>
            <td th:text="${r.usuario.nombre}"></td>
            <td th:text="${r.usuarioAdmin != null ? r.usuarioAdmin.nombre : 'No asignado'}"></td>
            <td>
                <a href="#" th:attr="data-id=${r.id}" onclick="confirmarEliminar(this)">Eliminar</a> |
                <select th:disabled="${r.estado == 'RESUELTO'}" onchange="mostrarConfirmacionCambioEstado(this)" th:attr="data-id=${r.id}">
                    <option value="" selected disabled>Cambiar Estado</option>
                    <option th:value="'EN_PROGRESO'" th:selected="${r.estado == 'EN_PROGRESO'}">En Progreso</option>
                    <option th:value="'RESUELTO'" th:selected="${r.estado == 'RESUELTO'}">Resuelto</option>
                </select>
            </td>
        </tr>
    </table>

    <br>
    <button type="button" id="btnSalir">Salir</button>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script th:src="@{/js/script.js}"></script>
</body>
</html>
